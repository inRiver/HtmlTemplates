<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>CVL Editor</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>
<body class="container mt-4">

    <div id="app">
        <div v-if="mode=='cvlListing'">
            <div class="row d-flex mb-3 align-items-center"
                 v-for="cvl in allCvls"
                 v-on:click="cvlValueEdit(cvl)">
                <div class="col-4">
                    {{cvl.id}}
                </div>
                <div class="col-4">
                    {{cvl.dataType}}
                </div>
                <div class="col-4">
                    <button class="btn btn-info">Edit</button>
                    <button class="btn btn-info">Delete</button>
                </div>
                <hr style="width: 100%; text-align: left; margin-left: 0">
            </div>
        </div>
        <div v-if="mode=='cvlEditLocaleString'">
            <table></table>
        </div>
        <div v-if="mode=='cvlEditString'">
            <table>
                <thead>
                    <tr>
                        <th class="col-xs-3">Key</th>
                        <th class="col-xs-2">Index</th>
                        <th class="col-xs-4">Value</th>
                        <th class="col-xs-3"></th>
                    </tr>
                </thead>
                <tbody v-for="cvlValue in currentCvl">
                    <tr>
                        <td>
                            {{cvlValue.key}}
                        </td>
                        <td>
                            {{cvlValue.index}}
                        </td>
                        <td>
                            {{cvlValue.value}}
                        </td>
                        <td>
                            <button class="btn btn-info">Edit</button>
                            <button class="btn btn-info">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>

    <script>
        var fallbackApiKey = "2eb0108ce0eefd1b959f3c0a96a27328";
        var apiKey = fallbackApiKey;
        var language = "en";
        var baseUrl = "https://apieuw.productmarketingcloud.com/api/v1.0.0/";

        var app = new Vue({
            el: "#app",
            data: {
                allCvls: [],
                mode: "cvlListing",
                currentCvl: null
            },
            mounted: function () {
                this.fetchAllCvls();
            },
            methods: {
                fetchAllCvls: function () {
                    var self = this;
                    $.getJSON(buildAjaxSettings("model/cvls", false), function (cvls) {
                        cvls.forEach(function (item, index) {
                            var cvlWithValues = item;
                            cvlWithValues.values = [];
                            self.allCvls.push(cvlWithValues);
                        });
                    });
                },
                fetchCvlValues: function(cvl) {
                    var self = this;
                    $.getJSON(buildAjaxSettings("model/cvls/" + cvl.id + "/values", false), function (cvlValues) {
                        cvl.values = cvlValues;
                    });
                },
                cvlValueEdit: function(cvl) {
                    fetchCvlValues(cvl);
                    if (cvl.dataType === "LocaleString") {
                        this.mode = "cvlEditLocaleString";
                    }
                    if (cvl.dataType === "String") {
                        this.mode = "cvlEditString";
                    }
                    this.currentCvl = cvl;
                }
            }
        });

        function buildAjaxSettings(restOperation, asyncOperation = true) {
            var ajaxSettings = {
                dataType: "json",
                contentType: 'application/json',
                headers: {
                    'X-inRiver-APIKey': apiKey,
                    'Accept': 'application/json',
                    'Accept-Language': language
                },
                url: baseUrl + restOperation,
                processData: true,
                async: asyncOperation
            };
            return ajaxSettings;
        }

    </script>

</body>
</html>